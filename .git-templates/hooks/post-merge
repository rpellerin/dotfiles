#!/bin/bash -e

# git hook to run a command after `git pull` if a specified file was changed

changed_files="$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)"

check_run() {
	grep --quiet -E "$1" <<< "$changed_files"
}

# In this example it's used to run `yarn` if yarn.lock changed
check_run "yarn\.lock" && kill -s USR1 "$(cat /tmp/node-exec.sh.pid)" >/dev/null 2>&1
check_run "db\/|Gemfile\.lock" && ./bin/setup >/dev/null 2>&1 &
